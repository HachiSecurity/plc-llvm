<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-- | This module contains code generators for runtime, value equality checks.</span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hachi.Compiler.CodeGen.Equality</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-5"></span><span>    </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Equality.html#eqData"><span class="hs-identifier">eqData</span></a></span><span>
</span><span id="line-6"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">LLVM.AST</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">LLVM.AST.Constant</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">LLVM.AST.IntegerPredicate</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LLVM</span></span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Closure.html"><span class="hs-identifier">Hachi.Compiler.CodeGen.Closure</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Constant.html"><span class="hs-identifier">Hachi.Compiler.CodeGen.Constant</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Constant.ByteString.html"><span class="hs-identifier">Hachi.Compiler.CodeGen.Constant.ByteString</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Constant.Data.html"><span class="hs-identifier">Hachi.Compiler.CodeGen.Constant.Data</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Constant.List.html"><span class="hs-identifier">Hachi.Compiler.CodeGen.Constant.List</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Constant.Pair.html"><span class="hs-identifier">Hachi.Compiler.CodeGen.Constant.Pair</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.CPS.html"><span class="hs-identifier">Hachi.Compiler.CodeGen.CPS</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Externals.html"><span class="hs-identifier">Hachi.Compiler.CodeGen.Externals</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.IRBuilder.html"><span class="hs-identifier">Hachi.Compiler.CodeGen.IRBuilder</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IR</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Monad.html"><span class="hs-identifier">Hachi.Compiler.CodeGen.Monad</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html"><span class="hs-identifier">Hachi.Compiler.CodeGen.Types</span></a></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">type</span><span> </span><span id="EqFun"><span class="annot"><a href="Hachi.Compiler.CodeGen.Equality.html#EqFun"><span class="hs-identifier hs-var">EqFun</span></a></span></span><span> </span><span id="local-6989586621679262932"><span class="annot"><a href="#local-6989586621679262932"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#ClosurePtr"><span class="hs-identifier hs-type">ClosurePtr</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#DynamicPtr"><span class="hs-identifier hs-type">DynamicPtr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#ClosurePtr"><span class="hs-identifier hs-type">ClosurePtr</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#DynamicPtr"><span class="hs-identifier hs-type">DynamicPtr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679262932"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="annot"><a href="Hachi.Compiler.CodeGen.Equality.html#eqType"><span class="hs-identifier hs-type">eqType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-31"></span><span id="eqType"><span class="annot"><span class="annottext">eqType :: Type
</span><a href="Hachi.Compiler.CodeGen.Equality.html#eqType"><span class="hs-identifier hs-var hs-var">eqType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#ptrOf"><span class="hs-identifier hs-var">ptrOf</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Bool -&gt; Type
</span><span class="hs-identifier hs-var">FunctionType</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#i1"><span class="hs-identifier hs-var">i1</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#closureTyPtr"><span class="hs-identifier hs-var">closureTyPtr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#closureTyPtr"><span class="hs-identifier hs-var">closureTyPtr</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="annot"><a href="Hachi.Compiler.CodeGen.Equality.html#eqDataRef"><span class="hs-identifier hs-type">eqDataRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span>
</span><span id="line-34"></span><span id="eqDataRef"><span class="annot"><span class="annottext">eqDataRef :: Operand
</span><a href="Hachi.Compiler.CodeGen.Equality.html#eqDataRef"><span class="hs-identifier hs-var hs-var">eqDataRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="annot"><span class="annottext">(Constant -&gt; Operand) -&gt; Constant -&gt; Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Name -&gt; Constant
</span><span class="hs-identifier hs-var">GlobalReference</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Equality.html#eqType"><span class="hs-identifier hs-var">eqType</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;eqData&quot;</span></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-comment">-- | `eqInteger` @ptr0 ptr1@ forces two closures representing integer values</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- and checks that the resulting values are the same.</span><span>
</span><span id="line-38"></span><span id="local-6989586621679262934"><span class="annot"><a href="Hachi.Compiler.CodeGen.Equality.html#eqInteger"><span class="hs-identifier hs-type">eqInteger</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hachi.Compiler.CodeGen.Monad.html#MonadCodeGen"><span class="hs-identifier hs-type">MonadCodeGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679262934"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIRBuilder</span></span><span> </span><span class="annot"><a href="#local-6989586621679262934"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#ClosurePtr"><span class="hs-identifier hs-type">ClosurePtr</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#DynamicPtr"><span class="hs-identifier hs-type">DynamicPtr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#ClosurePtr"><span class="hs-identifier hs-type">ClosurePtr</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#DynamicPtr"><span class="hs-identifier hs-type">DynamicPtr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679262934"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-41"></span><span id="eqInteger"><span class="annot"><span class="annottext">eqInteger :: ClosurePtr 'DynamicPtr -&gt; ClosurePtr 'DynamicPtr -&gt; m ()
</span><a href="Hachi.Compiler.CodeGen.Equality.html#eqInteger"><span class="hs-identifier hs-var hs-var">eqInteger</span></a></span></span><span> </span><span id="local-6989586621679262922"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262922"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679262921"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262921"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *) (k :: PtrKind).
(MonadFail m, MonadModuleBuilder m, MonadIRBuilder m) =&gt;
ClosurePtr k
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Closure.html#enterClosure"><span class="hs-identifier hs-var">enterClosure</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262922"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Continuation
</span><a href="Hachi.Compiler.CodeGen.CPS.html#cpsReturnCont"><span class="hs-identifier hs-var">cpsReturnCont</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Operand
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-43"></span><span>    </span><span id="local-6989586621679262918"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262918"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m Operand
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Type -&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.Constant.html#loadConstVal"><span class="hs-identifier hs-var">loadConstVal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#gmpTyPtr"><span class="hs-identifier hs-var">gmpTyPtr</span></a></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *) (k :: PtrKind).
(MonadFail m, MonadModuleBuilder m, MonadIRBuilder m) =&gt;
ClosurePtr k
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Closure.html#enterClosure"><span class="hs-identifier hs-var">enterClosure</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262921"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Continuation
</span><a href="Hachi.Compiler.CodeGen.CPS.html#cpsReturnCont"><span class="hs-identifier hs-var">cpsReturnCont</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Operand
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-46"></span><span>    </span><span id="local-6989586621679262915"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262915"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m Operand
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Type -&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.Constant.html#loadConstVal"><span class="hs-identifier hs-var">loadConstVal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#gmpTyPtr"><span class="hs-identifier hs-var">gmpTyPtr</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span>    </span><span id="local-6989586621679262914"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262914"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; m Operand
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Operand -&gt; Operand -&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.Externals.GMP.html#mpzCmp"><span class="hs-identifier hs-var">mpzCmp</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262918"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262915"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="annottext">IntegerPredicate -&gt; Operand -&gt; Operand -&gt; m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
IntegerPredicate -&gt; Operand -&gt; Operand -&gt; m Operand
</span><span class="hs-identifier hs-var">icmp</span></span><span> </span><span class="annot"><span class="annottext">IntegerPredicate
</span><span class="hs-identifier hs-var">LLVM.EQ</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262914"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="annot"><span class="annottext">(Constant -&gt; Operand) -&gt; Constant -&gt; Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Integer -&gt; Constant
</span><span class="hs-identifier hs-var">Int</span></span><span> </span><span class="annot"><span class="annottext">Word32
forall a. Num a =&gt; a
</span><a href="Hachi.Compiler.Platform.html#platformIntSize"><span class="hs-identifier hs-var">platformIntSize</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m Operand -&gt; (Operand -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Operand -&gt; m ()
</span><span class="hs-identifier hs-var">ret</span></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-comment">-- | `eqByteString` @ptr0 ptr1@ forces two closures representing bytestring</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- values and checks that the resulting values are the same.</span><span>
</span><span id="line-53"></span><span id="local-6989586621679262907"><span class="annot"><a href="Hachi.Compiler.CodeGen.Equality.html#eqByteString"><span class="hs-identifier hs-type">eqByteString</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hachi.Compiler.CodeGen.Monad.html#MonadCodeGen"><span class="hs-identifier hs-type">MonadCodeGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679262907"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIRBuilder</span></span><span> </span><span class="annot"><a href="#local-6989586621679262907"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#ClosurePtr"><span class="hs-identifier hs-type">ClosurePtr</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#DynamicPtr"><span class="hs-identifier hs-type">DynamicPtr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#ClosurePtr"><span class="hs-identifier hs-type">ClosurePtr</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#DynamicPtr"><span class="hs-identifier hs-type">DynamicPtr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679262907"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-56"></span><span id="eqByteString"><span class="annot"><span class="annottext">eqByteString :: ClosurePtr 'DynamicPtr -&gt; ClosurePtr 'DynamicPtr -&gt; m ()
</span><a href="Hachi.Compiler.CodeGen.Equality.html#eqByteString"><span class="hs-identifier hs-var hs-var">eqByteString</span></a></span></span><span> </span><span id="local-6989586621679262905"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262905"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621679262904"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262904"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *) (k :: PtrKind).
(MonadFail m, MonadModuleBuilder m, MonadIRBuilder m) =&gt;
ClosurePtr k
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Closure.html#enterClosure"><span class="hs-identifier hs-var">enterClosure</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262905"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Continuation
</span><a href="Hachi.Compiler.CodeGen.CPS.html#cpsReturnCont"><span class="hs-identifier hs-var">cpsReturnCont</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Operand
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-58"></span><span>    </span><span id="local-6989586621679262903"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262903"><span class="hs-identifier hs-var">s0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m Operand
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Type -&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.Constant.html#loadConstVal"><span class="hs-identifier hs-var">loadConstVal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#bytestringTyPtr"><span class="hs-identifier hs-var">bytestringTyPtr</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *) (k :: PtrKind).
(MonadFail m, MonadModuleBuilder m, MonadIRBuilder m) =&gt;
ClosurePtr k
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Closure.html#enterClosure"><span class="hs-identifier hs-var">enterClosure</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262904"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="annot"><span class="annottext">Continuation
</span><a href="Hachi.Compiler.CodeGen.CPS.html#cpsReturnCont"><span class="hs-identifier hs-var">cpsReturnCont</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Operand
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-61"></span><span>    </span><span id="local-6989586621679262901"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262901"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m Operand
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Type -&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.Constant.html#loadConstVal"><span class="hs-identifier hs-var">loadConstVal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#bytestringTyPtr"><span class="hs-identifier hs-var">bytestringTyPtr</span></a></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-comment">-- call equalsByteString which returns a char, but it will always just use</span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-comment">-- one bit, so we can safely truncate it</span><span>
</span><span id="line-65"></span><span>    </span><span id="local-6989586621679262900"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262900"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; m Operand
forall (m :: * -&gt; *).
(MonadCodeGen m, MonadIRBuilder m) =&gt;
Operand -&gt; Operand -&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.Constant.ByteString.html#bsEquals"><span class="hs-identifier hs-var">bsEquals</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262903"><span class="hs-identifier hs-var">s0</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262901"><span class="hs-identifier hs-var">s1</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><span class="annottext">Operand -&gt; m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Operand -&gt; m ()
</span><span class="hs-identifier hs-var">ret</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262900"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-comment">-- | `eqPair` @ptr0 ptr1@ forces two closures representing pairs containing</span><span>
</span><span id="line-69"></span><span class="hs-comment">-- `Data` values and checks that both components of the pair are the same.</span><span>
</span><span id="line-70"></span><span id="local-6989586621679262935"><span class="annot"><a href="Hachi.Compiler.CodeGen.Equality.html#eqPair"><span class="hs-identifier hs-type">eqPair</span></a></span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hachi.Compiler.CodeGen.Monad.html#MonadCodeGen"><span class="hs-identifier hs-type">MonadCodeGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679262935"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIRBuilder</span></span><span> </span><span class="annot"><a href="#local-6989586621679262935"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#ClosurePtr"><span class="hs-identifier hs-type">ClosurePtr</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#DynamicPtr"><span class="hs-identifier hs-type">DynamicPtr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#ClosurePtr"><span class="hs-identifier hs-type">ClosurePtr</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#DynamicPtr"><span class="hs-identifier hs-type">DynamicPtr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679262935"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span></span><span>
</span><span id="line-73"></span><span id="eqPair"><span class="annot"><span class="annottext">eqPair :: ClosurePtr 'DynamicPtr -&gt; ClosurePtr 'DynamicPtr -&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.Equality.html#eqPair"><span class="hs-identifier hs-var hs-var">eqPair</span></a></span></span><span> </span><span id="local-6989586621679262897"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262897"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679262896"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262896"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-comment">-- force the two argument closures</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *) (k :: PtrKind).
(MonadFail m, MonadModuleBuilder m, MonadIRBuilder m) =&gt;
ClosurePtr k
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Closure.html#enterClosure"><span class="hs-identifier hs-var">enterClosure</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262897"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Continuation
</span><a href="Hachi.Compiler.CodeGen.CPS.html#cpsReturnCont"><span class="hs-identifier hs-var">cpsReturnCont</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Operand
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-76"></span><span>    </span><span id="local-6989586621679262895"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262895"><span class="hs-identifier hs-var">p0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m Operand
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Type -&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.Constant.html#loadConstVal"><span class="hs-identifier hs-var">loadConstVal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#pairTyPtr"><span class="hs-identifier hs-var">pairTyPtr</span></a></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *) (k :: PtrKind).
(MonadFail m, MonadModuleBuilder m, MonadIRBuilder m) =&gt;
ClosurePtr k
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Closure.html#enterClosure"><span class="hs-identifier hs-var">enterClosure</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262896"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Continuation
</span><a href="Hachi.Compiler.CodeGen.CPS.html#cpsReturnCont"><span class="hs-identifier hs-var">cpsReturnCont</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Operand
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-79"></span><span>    </span><span id="local-6989586621679262893"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262893"><span class="hs-identifier hs-var">p1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m Operand
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Type -&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.Constant.html#loadConstVal"><span class="hs-identifier hs-var">loadConstVal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#pairTyPtr"><span class="hs-identifier hs-var">pairTyPtr</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-comment">-- retrieve the first component from each pair and check that they</span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-comment">-- are the same</span><span>
</span><span id="line-83"></span><span>    </span><span id="local-6989586621679262892"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262892"><span class="hs-identifier hs-var">p0x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Constant.Pair.html#getFst"><span class="hs-identifier hs-var">getFst</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262895"><span class="hs-identifier hs-var">p0</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span id="local-6989586621679262890"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262890"><span class="hs-identifier hs-var">p1x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Constant.Pair.html#getFst"><span class="hs-identifier hs-var">getFst</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262893"><span class="hs-identifier hs-var">p1</span></a></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span>    </span><span id="local-6989586621679262889"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262889"><span class="hs-identifier hs-var">xeq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand
-&gt; [(Operand, [ParameterAttribute])]
-&gt; (Instruction -&gt; Instruction)
-&gt; m Operand
forall (m :: * -&gt; *).
(HasCallStack, MonadFail m, MonadIRBuilder m,
 MonadModuleBuilder m) =&gt;
Operand
-&gt; [(Operand, [ParameterAttribute])]
-&gt; (Instruction -&gt; Instruction)
-&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.IRBuilder.html#call"><span class="hs-identifier hs-var">call</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Hachi.Compiler.CodeGen.Equality.html#eqDataRef"><span class="hs-identifier hs-var">eqDataRef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr -&gt; Operand
forall (k :: PtrKind) to. FromClosurePtr k to =&gt; ClosurePtr k -&gt; to
</span><a href="Hachi.Compiler.CodeGen.Types.html#closurePtr"><span class="hs-identifier hs-var">closurePtr</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262892"><span class="hs-identifier hs-var">p0x</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr -&gt; Operand
forall (k :: PtrKind) to. FromClosurePtr k to =&gt; ClosurePtr k -&gt; to
</span><a href="Hachi.Compiler.CodeGen.Types.html#closurePtr"><span class="hs-identifier hs-var">closurePtr</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262890"><span class="hs-identifier hs-var">p1x</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Instruction -&gt; Instruction
</span><a href="Hachi.Compiler.CodeGen.IRBuilder.html#plcCall"><span class="hs-identifier hs-var">plcCall</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-comment">-- retrieve the second component from each pair and check that they</span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-comment">-- are the same</span><span>
</span><span id="line-90"></span><span>    </span><span id="local-6989586621679262885"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262885"><span class="hs-identifier hs-var">p0y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Constant.Pair.html#getSnd"><span class="hs-identifier hs-var">getSnd</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262895"><span class="hs-identifier hs-var">p0</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span id="local-6989586621679262883"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262883"><span class="hs-identifier hs-var">p1y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Constant.Pair.html#getSnd"><span class="hs-identifier hs-var">getSnd</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262893"><span class="hs-identifier hs-var">p1</span></a></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span>    </span><span id="local-6989586621679262882"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262882"><span class="hs-identifier hs-var">yeq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand
-&gt; [(Operand, [ParameterAttribute])]
-&gt; (Instruction -&gt; Instruction)
-&gt; m Operand
forall (m :: * -&gt; *).
(HasCallStack, MonadFail m, MonadIRBuilder m,
 MonadModuleBuilder m) =&gt;
Operand
-&gt; [(Operand, [ParameterAttribute])]
-&gt; (Instruction -&gt; Instruction)
-&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.IRBuilder.html#call"><span class="hs-identifier hs-var">call</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Hachi.Compiler.CodeGen.Equality.html#eqDataRef"><span class="hs-identifier hs-var">eqDataRef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr -&gt; Operand
forall (k :: PtrKind) to. FromClosurePtr k to =&gt; ClosurePtr k -&gt; to
</span><a href="Hachi.Compiler.CodeGen.Types.html#closurePtr"><span class="hs-identifier hs-var">closurePtr</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262885"><span class="hs-identifier hs-var">p0y</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr -&gt; Operand
forall (k :: PtrKind) to. FromClosurePtr k to =&gt; ClosurePtr k -&gt; to
</span><a href="Hachi.Compiler.CodeGen.Types.html#closurePtr"><span class="hs-identifier hs-var">closurePtr</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262883"><span class="hs-identifier hs-var">p1y</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Instruction -&gt; Instruction
</span><a href="Hachi.Compiler.CodeGen.IRBuilder.html#plcCall"><span class="hs-identifier hs-var">plcCall</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-comment">-- succeed if both components are equal</span><span>
</span><span id="line-96"></span><span>    </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; m Operand
forall (m :: * -&gt; *).
(MonadIRBuilder m, MonadModuleBuilder m) =&gt;
Operand -&gt; Operand -&gt; m Operand
</span><span class="hs-identifier hs-var">IR.and</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262889"><span class="hs-identifier hs-var">xeq</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262882"><span class="hs-identifier hs-var">yeq</span></a></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">-- | `eqList` @compare ptr0 ptr1@ forces two closures representing lists</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- and checks that all elements are the same using a comparison check</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- produced by @compare@.</span><span>
</span><span id="line-101"></span><span id="local-6989586621679262936"><span class="annot"><a href="Hachi.Compiler.CodeGen.Equality.html#eqList"><span class="hs-identifier hs-type">eqList</span></a></span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hachi.Compiler.CodeGen.Monad.html#MonadCodeGen"><span class="hs-identifier hs-type">MonadCodeGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679262936"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIRBuilder</span></span><span> </span><span class="annot"><a href="#local-6989586621679262936"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Equality.html#EqFun"><span class="hs-identifier hs-type">EqFun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679262936"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#ClosurePtr"><span class="hs-identifier hs-type">ClosurePtr</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#DynamicPtr"><span class="hs-identifier hs-type">DynamicPtr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#ClosurePtr"><span class="hs-identifier hs-type">ClosurePtr</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hachi.Compiler.CodeGen.Types.html#DynamicPtr"><span class="hs-identifier hs-type">DynamicPtr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679262936"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-104"></span><span id="eqList"><span class="annot"><span class="annottext">eqList :: EqFun m -&gt; ClosurePtr 'DynamicPtr -&gt; ClosurePtr 'DynamicPtr -&gt; m ()
</span><a href="Hachi.Compiler.CodeGen.Equality.html#eqList"><span class="hs-identifier hs-var hs-var">eqList</span></a></span></span><span> </span><span id="local-6989586621679262879"><span class="annot"><span class="annottext">EqFun m
</span><a href="#local-6989586621679262879"><span class="hs-identifier hs-var">xEq</span></a></span></span><span> </span><span id="local-6989586621679262878"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262878"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621679262877"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262877"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-comment">-- allocate stack space for the two list closure pointers and store the</span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-comment">-- initial pointers in it</span><span>
</span><span id="line-107"></span><span>    </span><span id="local-6989586621679262876"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262876"><span class="hs-identifier hs-var">l0Var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Operand -&gt; Word32 -&gt; m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Type -&gt; Maybe Operand -&gt; Word32 -&gt; m Operand
</span><span class="hs-identifier hs-var">alloca</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#closureTyPtr"><span class="hs-identifier hs-var">closureTyPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Operand
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span>
</span><span id="line-108"></span><span>    </span><span id="local-6989586621679262874"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262874"><span class="hs-identifier hs-var">l1Var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Operand -&gt; Word32 -&gt; m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Type -&gt; Maybe Operand -&gt; Word32 -&gt; m Operand
</span><span class="hs-identifier hs-var">alloca</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#closureTyPtr"><span class="hs-identifier hs-var">closureTyPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Operand
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><span class="annottext">Operand -&gt; Word32 -&gt; Operand -&gt; m ()
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Word32 -&gt; Operand -&gt; m ()
</span><span class="hs-identifier hs-var">store</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262876"><span class="hs-identifier hs-var">l0Var</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr -&gt; Operand
forall (k :: PtrKind) to. FromClosurePtr k to =&gt; ClosurePtr k -&gt; to
</span><a href="Hachi.Compiler.CodeGen.Types.html#closurePtr"><span class="hs-identifier hs-var">closurePtr</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262878"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><span class="annottext">Operand -&gt; Word32 -&gt; Operand -&gt; m ()
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Word32 -&gt; Operand -&gt; m ()
</span><span class="hs-identifier hs-var">store</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262874"><span class="hs-identifier hs-var">l1Var</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr -&gt; Operand
forall (k :: PtrKind) to. FromClosurePtr k to =&gt; ClosurePtr k -&gt; to
</span><a href="Hachi.Compiler.CodeGen.Types.html#closurePtr"><span class="hs-identifier hs-var">closurePtr</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262877"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-comment">-- comparing lists is a big loop, which we immediately jump to</span><span>
</span><span id="line-113"></span><span>    </span><span id="local-6989586621679262872"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262872"><span class="hs-identifier hs-var">loopBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; m Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; ShortByteString -&gt; m Name
</span><span class="hs-identifier hs-var">freshName</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><span class="hs-string">&quot;loop&quot;</span></span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><span class="annottext">Name -&gt; m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">br</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262872"><span class="hs-identifier hs-var">loopBranch</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><span class="annottext">Name -&gt; m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">emitBlockStart</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262872"><span class="hs-identifier hs-var">loopBranch</span></a></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-comment">-- retrieve the list closure pointers from the stack and retrieve the</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-comment">-- actual list pointers from them</span><span>
</span><span id="line-120"></span><span>    </span><span id="local-6989586621679262868"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262868"><span class="hs-identifier hs-var">l0Val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Word32 -&gt; m Operand
forall (m :: * -&gt; *).
(HasCallStack, MonadIRBuilder m, MonadModuleBuilder m) =&gt;
Operand -&gt; Word32 -&gt; m Operand
</span><span class="hs-identifier hs-var">load</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262876"><span class="hs-identifier hs-var">l0Var</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *) (k :: PtrKind).
(MonadFail m, MonadModuleBuilder m, MonadIRBuilder m) =&gt;
ClosurePtr k
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Closure.html#enterClosure"><span class="hs-identifier hs-var">enterClosure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; ClosurePtr 'DynamicPtr
</span><a href="Hachi.Compiler.CodeGen.Types.html#MkClosurePtr"><span class="hs-identifier hs-var">MkClosurePtr</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262868"><span class="hs-identifier hs-var">l0Val</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Continuation
</span><a href="Hachi.Compiler.CodeGen.CPS.html#cpsReturnCont"><span class="hs-identifier hs-var">cpsReturnCont</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Operand
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-122"></span><span>    </span><span id="local-6989586621679262865"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262865"><span class="hs-identifier hs-var">l0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m Operand
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Type -&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.Constant.html#loadConstVal"><span class="hs-identifier hs-var">loadConstVal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#listTyPtr"><span class="hs-identifier hs-var">listTyPtr</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621679262863"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262863"><span class="hs-identifier hs-var">l1Val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Word32 -&gt; m Operand
forall (m :: * -&gt; *).
(HasCallStack, MonadIRBuilder m, MonadModuleBuilder m) =&gt;
Operand -&gt; Word32 -&gt; m Operand
</span><span class="hs-identifier hs-var">load</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262874"><span class="hs-identifier hs-var">l1Var</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *) (k :: PtrKind).
(MonadFail m, MonadModuleBuilder m, MonadIRBuilder m) =&gt;
ClosurePtr k
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Closure.html#enterClosure"><span class="hs-identifier hs-var">enterClosure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; ClosurePtr 'DynamicPtr
</span><a href="Hachi.Compiler.CodeGen.Types.html#MkClosurePtr"><span class="hs-identifier hs-var">MkClosurePtr</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262863"><span class="hs-identifier hs-var">l1Val</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Continuation
</span><a href="Hachi.Compiler.CodeGen.CPS.html#cpsReturnCont"><span class="hs-identifier hs-var">cpsReturnCont</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Operand
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-126"></span><span>    </span><span id="local-6989586621679262862"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262862"><span class="hs-identifier hs-var">l1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m Operand
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Type -&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.Constant.html#loadConstVal"><span class="hs-identifier hs-var">loadConstVal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#listTyPtr"><span class="hs-identifier hs-var">listTyPtr</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-comment">-- we create block names for all the possibilities we might encounter</span><span>
</span><span id="line-129"></span><span>    </span><span id="local-6989586621679262861"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262861"><span class="hs-identifier hs-var">eqBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; m Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; ShortByteString -&gt; m Name
</span><span class="hs-identifier hs-var">freshName</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><span class="hs-string">&quot;eq&quot;</span></span><span>
</span><span id="line-130"></span><span>    </span><span id="local-6989586621679262860"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262860"><span class="hs-identifier hs-var">neqBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; m Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; ShortByteString -&gt; m Name
</span><span class="hs-identifier hs-var">freshName</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><span class="hs-string">&quot;neq&quot;</span></span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621679262859"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262859"><span class="hs-identifier hs-var">l0EmptyBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; m Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; ShortByteString -&gt; m Name
</span><span class="hs-identifier hs-var">freshName</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><span class="hs-string">&quot;l0empty&quot;</span></span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621679262858"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262858"><span class="hs-identifier hs-var">l0ConsBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; m Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; ShortByteString -&gt; m Name
</span><span class="hs-identifier hs-var">freshName</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><span class="hs-string">&quot;l0cons&quot;</span></span><span>
</span><span id="line-133"></span><span>    </span><span id="local-6989586621679262857"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262857"><span class="hs-identifier hs-var">bothConsBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; m Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; ShortByteString -&gt; m Name
</span><span class="hs-identifier hs-var">freshName</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><span class="hs-string">&quot;cons&quot;</span></span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621679262856"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262856"><span class="hs-identifier hs-var">headEqualBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; m Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; ShortByteString -&gt; m Name
</span><span class="hs-identifier hs-var">freshName</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><span class="hs-string">&quot;tails&quot;</span></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span>    </span><span id="local-6989586621679262855"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262855"><span class="hs-identifier hs-var">l0Null</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntegerPredicate -&gt; Operand -&gt; Operand -&gt; m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
IntegerPredicate -&gt; Operand -&gt; Operand -&gt; m Operand
</span><span class="hs-identifier hs-var">icmp</span></span><span> </span><span class="annot"><span class="annottext">IntegerPredicate
</span><span class="hs-identifier hs-var">LLVM.EQ</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262865"><span class="hs-identifier hs-var">l0</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="annot"><span class="annottext">(Constant -&gt; Operand) -&gt; Constant -&gt; Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Constant
</span><span class="hs-identifier hs-var">Null</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#listTyPtr"><span class="hs-identifier hs-var">listTyPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>    </span><span id="local-6989586621679262853"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262853"><span class="hs-identifier hs-var">l1Null</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntegerPredicate -&gt; Operand -&gt; Operand -&gt; m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
IntegerPredicate -&gt; Operand -&gt; Operand -&gt; m Operand
</span><span class="hs-identifier hs-var">icmp</span></span><span> </span><span class="annot"><span class="annottext">IntegerPredicate
</span><span class="hs-identifier hs-var">LLVM.EQ</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262862"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="annot"><span class="annottext">(Constant -&gt; Operand) -&gt; Constant -&gt; Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Constant
</span><span class="hs-identifier hs-var">Null</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#listTyPtr"><span class="hs-identifier hs-var">listTyPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-comment">-- is the first list empty?</span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><span class="annottext">Operand -&gt; Name -&gt; Name -&gt; m ()
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Name -&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">condBr</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262855"><span class="hs-identifier hs-var">l0Null</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262859"><span class="hs-identifier hs-var">l0EmptyBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262858"><span class="hs-identifier hs-var">l0ConsBranch</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-comment">-- the first list is empty: check if the second list is also empty;</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-comment">-- if both are empty, they are equal - otherwise they are not</span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><span class="annottext">Name -&gt; m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">emitBlockStart</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262859"><span class="hs-identifier hs-var">l0EmptyBranch</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><span class="annottext">Operand -&gt; Name -&gt; Name -&gt; m ()
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Name -&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">condBr</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262853"><span class="hs-identifier hs-var">l1Null</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262861"><span class="hs-identifier hs-var">eqBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262860"><span class="hs-identifier hs-var">neqBranch</span></a></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-comment">-- the first list is not empty: check if the second list is also non-empty;</span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-comment">-- if both are non-empty, we need to perform more checks - otherwise, if</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-comment">-- the second list is empty, the two lists are not equal</span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="annottext">Name -&gt; m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">emitBlockStart</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262858"><span class="hs-identifier hs-var">l0ConsBranch</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><span class="annottext">Operand -&gt; Name -&gt; Name -&gt; m ()
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Name -&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">condBr</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262853"><span class="hs-identifier hs-var">l1Null</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262860"><span class="hs-identifier hs-var">neqBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262857"><span class="hs-identifier hs-var">bothConsBranch</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-comment">-- both lists are not empty: we need to check the heads and tails</span><span>
</span><span id="line-154"></span><span>    </span><span class="annot"><span class="annottext">Name -&gt; m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">emitBlockStart</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262857"><span class="hs-identifier hs-var">bothConsBranch</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-comment">-- retrieve both heads and compare them; if they are equal, we need to then</span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-comment">-- check the tails as well - otherwise the two lists are not equal</span><span>
</span><span id="line-158"></span><span>    </span><span id="local-6989586621679262851"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262851"><span class="hs-identifier hs-var">l0h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Constant.List.html#getHead"><span class="hs-identifier hs-var">getHead</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262865"><span class="hs-identifier hs-var">l0</span></a></span><span>
</span><span id="line-159"></span><span>    </span><span id="local-6989586621679262849"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262849"><span class="hs-identifier hs-var">l1h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Constant.List.html#getHead"><span class="hs-identifier hs-var">getHead</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262862"><span class="hs-identifier hs-var">l1</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621679262848"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262848"><span class="hs-identifier hs-var">heq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EqFun m
</span><a href="#local-6989586621679262879"><span class="hs-identifier hs-var">xEq</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262851"><span class="hs-identifier hs-var">l0h</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262849"><span class="hs-identifier hs-var">l1h</span></a></span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><span class="annottext">Operand -&gt; Name -&gt; Name -&gt; m ()
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Name -&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">condBr</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262848"><span class="hs-identifier hs-var">heq</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262856"><span class="hs-identifier hs-var">headEqualBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262860"><span class="hs-identifier hs-var">neqBranch</span></a></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-comment">-- the heads of both lists are the same: retrieve the tails, store them on</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-comment">-- the stack and jump back to the start of the loop</span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><span class="annottext">Name -&gt; m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">emitBlockStart</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262856"><span class="hs-identifier hs-var">headEqualBranch</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621679262847"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262847"><span class="hs-identifier hs-var">l0t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Constant.List.html#getTail"><span class="hs-identifier hs-var">getTail</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262865"><span class="hs-identifier hs-var">l0</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><span class="annottext">Operand -&gt; Word32 -&gt; Operand -&gt; m ()
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Word32 -&gt; Operand -&gt; m ()
</span><span class="hs-identifier hs-var">store</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262876"><span class="hs-identifier hs-var">l0Var</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr -&gt; Operand
forall (k :: PtrKind) to. FromClosurePtr k to =&gt; ClosurePtr k -&gt; to
</span><a href="Hachi.Compiler.CodeGen.Types.html#closurePtr"><span class="hs-identifier hs-var">closurePtr</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262847"><span class="hs-identifier hs-var">l0t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>    </span><span id="local-6989586621679262845"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262845"><span class="hs-identifier hs-var">l1t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Constant.List.html#getTail"><span class="hs-identifier hs-var">getTail</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262862"><span class="hs-identifier hs-var">l1</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><span class="annottext">Operand -&gt; Word32 -&gt; Operand -&gt; m ()
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Word32 -&gt; Operand -&gt; m ()
</span><span class="hs-identifier hs-var">store</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262874"><span class="hs-identifier hs-var">l1Var</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr -&gt; Operand
forall (k :: PtrKind) to. FromClosurePtr k to =&gt; ClosurePtr k -&gt; to
</span><a href="Hachi.Compiler.CodeGen.Types.html#closurePtr"><span class="hs-identifier hs-var">closurePtr</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262845"><span class="hs-identifier hs-var">l1t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span>    </span><span class="annot"><span class="annottext">Name -&gt; m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">br</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262872"><span class="hs-identifier hs-var">loopBranch</span></a></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-comment">-- the lists are equal</span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><span class="annottext">Name -&gt; m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">emitBlockStart</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262861"><span class="hs-identifier hs-var">eqBranch</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span class="annot"><span class="annottext">Operand -&gt; m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Operand -&gt; m ()
</span><span class="hs-identifier hs-var">ret</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="annot"><span class="annottext">(Constant -&gt; Operand) -&gt; Constant -&gt; Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Integer -&gt; Constant
</span><span class="hs-identifier hs-var">Int</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-comment">-- the lists are not equal</span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><span class="annottext">Name -&gt; m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">emitBlockStart</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262860"><span class="hs-identifier hs-var">neqBranch</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><span class="annottext">Operand -&gt; m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Operand -&gt; m ()
</span><span class="hs-identifier hs-var">ret</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="annot"><span class="annottext">(Constant -&gt; Operand) -&gt; Constant -&gt; Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Integer -&gt; Constant
</span><span class="hs-identifier hs-var">Int</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-comment">-- | `eqData` is a computation which generates a function for comparing</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- `Data` values for value equality.</span><span>
</span><span id="line-185"></span><span id="local-6989586621679262844"><span class="annot"><a href="Hachi.Compiler.CodeGen.Equality.html#eqData"><span class="hs-identifier hs-type">eqData</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hachi.Compiler.CodeGen.Monad.html#MonadCodeGen"><span class="hs-identifier hs-type">MonadCodeGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679262844"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIRBuilder</span></span><span> </span><span class="annot"><a href="#local-6989586621679262844"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679262844"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span></span><span>
</span><span id="line-186"></span><span id="eqData"><span class="annot"><span class="annottext">eqData :: m Operand
</span><a href="Hachi.Compiler.CodeGen.Equality.html#eqData"><span class="hs-identifier hs-var hs-var">eqData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [(Type, ParameterName)]
-&gt; Type
-&gt; (Global -&gt; Global)
-&gt; ([Operand] -&gt; IRBuilderT m ())
-&gt; m Operand
forall (m :: * -&gt; *).
MonadModuleBuilder m =&gt;
Name
-&gt; [(Type, ParameterName)]
-&gt; Type
-&gt; (Global -&gt; Global)
-&gt; ([Operand] -&gt; IRBuilderT m ())
-&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.IRBuilder.html#function"><span class="hs-identifier hs-var">IR.function</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;eqData&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#closureTyPtr"><span class="hs-identifier hs-var">closureTyPtr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ParameterName
</span><span class="hs-string">&quot;x&quot;</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#closureTyPtr"><span class="hs-identifier hs-var">closureTyPtr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ParameterName
</span><span class="hs-string">&quot;y&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#i1"><span class="hs-identifier hs-var">i1</span></a></span><span> </span><span class="annot"><span class="annottext">Global -&gt; Global
</span><a href="Hachi.Compiler.CodeGen.IRBuilder.html#plcFunOpts"><span class="hs-identifier hs-var">plcFunOpts</span></a></span><span> </span><span class="annot"><span class="annottext">(([Operand] -&gt; IRBuilderT m ()) -&gt; m Operand)
-&gt; ([Operand] -&gt; IRBuilderT m ()) -&gt; m Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">[</span><span id="local-6989586621679262841"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262841"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679262840"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262840"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-comment">-- force both arguments and obtain their values, which should be pointers</span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-comment">-- to Data objects</span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
-&gt; Continuation
-&gt; Maybe Operand
-&gt; IRBuilderT m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *) (k :: PtrKind).
(MonadFail m, MonadModuleBuilder m, MonadIRBuilder m) =&gt;
ClosurePtr k
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Closure.html#enterClosure"><span class="hs-identifier hs-var">enterClosure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; ClosurePtr 'DynamicPtr
</span><a href="Hachi.Compiler.CodeGen.Types.html#MkClosurePtr"><span class="hs-identifier hs-var">MkClosurePtr</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262841"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Continuation
</span><a href="Hachi.Compiler.CodeGen.CPS.html#cpsReturnCont"><span class="hs-identifier hs-var">cpsReturnCont</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Operand
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-190"></span><span>    </span><span id="local-6989586621679262839"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262839"><span class="hs-identifier hs-var">d0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; IRBuilderT m Operand
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Type -&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.Constant.html#loadConstVal"><span class="hs-identifier hs-var">loadConstVal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#dataTyPtr"><span class="hs-identifier hs-var">dataTyPtr</span></a></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
-&gt; Continuation
-&gt; Maybe Operand
-&gt; IRBuilderT m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *) (k :: PtrKind).
(MonadFail m, MonadModuleBuilder m, MonadIRBuilder m) =&gt;
ClosurePtr k
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Closure.html#enterClosure"><span class="hs-identifier hs-var">enterClosure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; ClosurePtr 'DynamicPtr
</span><a href="Hachi.Compiler.CodeGen.Types.html#MkClosurePtr"><span class="hs-identifier hs-var">MkClosurePtr</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262840"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Continuation
</span><a href="Hachi.Compiler.CodeGen.CPS.html#cpsReturnCont"><span class="hs-identifier hs-var">cpsReturnCont</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Operand
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621679262837"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262837"><span class="hs-identifier hs-var">d1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; IRBuilderT m Operand
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Type -&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.Constant.html#loadConstVal"><span class="hs-identifier hs-var">loadConstVal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#dataTyPtr"><span class="hs-identifier hs-var">dataTyPtr</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-comment">-- first of all, we need to see that the two Data values were constructed</span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-comment">-- using the same constructor: for this we compare the tags</span><span>
</span><span id="line-197"></span><span>    </span><span id="local-6989586621679262836"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262836"><span class="hs-identifier hs-var">d0tag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; IRBuilderT m Operand
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Operand -&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.Constant.Data.html#loadDataTag"><span class="hs-identifier hs-var">loadDataTag</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262839"><span class="hs-identifier hs-var">d0</span></a></span><span>
</span><span id="line-198"></span><span>    </span><span id="local-6989586621679262834"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262834"><span class="hs-identifier hs-var">d1tag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; IRBuilderT m Operand
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Operand -&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.Constant.Data.html#loadDataTag"><span class="hs-identifier hs-var">loadDataTag</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262837"><span class="hs-identifier hs-var">d1</span></a></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span>    </span><span id="local-6989586621679262833"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262833"><span class="hs-identifier hs-var">eqBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; IRBuilderT m Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; ShortByteString -&gt; m Name
</span><span class="hs-identifier hs-var">freshName</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><span class="hs-string">&quot;eq&quot;</span></span><span>
</span><span id="line-201"></span><span>    </span><span id="local-6989586621679262832"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262832"><span class="hs-identifier hs-var">neqBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; IRBuilderT m Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; ShortByteString -&gt; m Name
</span><span class="hs-identifier hs-var">freshName</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><span class="hs-string">&quot;neq&quot;</span></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span>    </span><span id="local-6989586621679262831"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262831"><span class="hs-identifier hs-var">tagMatch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntegerPredicate -&gt; Operand -&gt; Operand -&gt; IRBuilderT m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
IntegerPredicate -&gt; Operand -&gt; Operand -&gt; m Operand
</span><span class="hs-identifier hs-var">icmp</span></span><span> </span><span class="annot"><span class="annottext">IntegerPredicate
</span><span class="hs-identifier hs-var">LLVM.EQ</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262836"><span class="hs-identifier hs-var">d0tag</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262834"><span class="hs-identifier hs-var">d1tag</span></a></span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><span class="annottext">Operand -&gt; Name -&gt; Name -&gt; IRBuilderT m ()
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Name -&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">condBr</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262831"><span class="hs-identifier hs-var">tagMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262833"><span class="hs-identifier hs-var">eqBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262832"><span class="hs-identifier hs-var">neqBranch</span></a></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-comment">-- the tags aren't the same, return false</span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><span class="annottext">Name -&gt; IRBuilderT m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">emitBlockStart</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262832"><span class="hs-identifier hs-var">neqBranch</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><span class="annottext">Operand -&gt; IRBuilderT m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Operand -&gt; m ()
</span><span class="hs-identifier hs-var">ret</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="annot"><span class="annottext">(Constant -&gt; Operand) -&gt; Constant -&gt; Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Integer -&gt; Constant
</span><span class="hs-identifier hs-var">Int</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-comment">-- the tags are the same, we have to perform more comparisons: all data</span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-comment">-- objects have a pointer to some payload so we retrieve that before</span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-comment">-- performing checks specific to each individual constructor</span><span>
</span><span id="line-213"></span><span>    </span><span class="annot"><span class="annottext">Name -&gt; IRBuilderT m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">emitBlockStart</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262833"><span class="hs-identifier hs-var">eqBranch</span></a></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span>    </span><span id="local-6989586621679262830"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262830"><span class="hs-identifier hs-var">d0ptr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; IRBuilderT m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Constant.Data.html#loadDataPtr"><span class="hs-identifier hs-var">loadDataPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262839"><span class="hs-identifier hs-var">d0</span></a></span><span>
</span><span id="line-216"></span><span>    </span><span id="local-6989586621679262828"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262828"><span class="hs-identifier hs-var">d1ptr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; IRBuilderT m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Constant.Data.html#loadDataPtr"><span class="hs-identifier hs-var">loadDataPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262837"><span class="hs-identifier hs-var">d1</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679262827"><span class="annot"><span class="annottext">callEqData :: ClosurePtr k -&gt; ClosurePtr k -&gt; m Operand
</span><a href="#local-6989586621679262827"><span class="hs-identifier hs-var hs-var">callEqData</span></a></span></span><span> </span><span id="local-6989586621679262826"><span class="annot"><span class="annottext">ClosurePtr k
</span><a href="#local-6989586621679262826"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679262825"><span class="annot"><span class="annottext">ClosurePtr k
</span><a href="#local-6989586621679262825"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-219"></span><span>            </span><span class="annot"><span class="annottext">Operand
-&gt; [(Operand, [ParameterAttribute])]
-&gt; (Instruction -&gt; Instruction)
-&gt; m Operand
forall (m :: * -&gt; *).
(HasCallStack, MonadFail m, MonadIRBuilder m,
 MonadModuleBuilder m) =&gt;
Operand
-&gt; [(Operand, [ParameterAttribute])]
-&gt; (Instruction -&gt; Instruction)
-&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.IRBuilder.html#call"><span class="hs-identifier hs-var">call</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Hachi.Compiler.CodeGen.Equality.html#eqDataRef"><span class="hs-identifier hs-var">eqDataRef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClosurePtr k -&gt; Operand
forall (k :: PtrKind) to. FromClosurePtr k to =&gt; ClosurePtr k -&gt; to
</span><a href="Hachi.Compiler.CodeGen.Types.html#closurePtr"><span class="hs-identifier hs-var">closurePtr</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr k
</span><a href="#local-6989586621679262826"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClosurePtr k -&gt; Operand
forall (k :: PtrKind) to. FromClosurePtr k to =&gt; ClosurePtr k -&gt; to
</span><a href="Hachi.Compiler.CodeGen.Types.html#closurePtr"><span class="hs-identifier hs-var">closurePtr</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr k
</span><a href="#local-6989586621679262825"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Instruction -&gt; Instruction
</span><a href="Hachi.Compiler.CodeGen.IRBuilder.html#plcCall"><span class="hs-identifier hs-var">plcCall</span></a></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span>    </span><span class="annot"><span class="annottext">Operand -&gt; (DataTag -&gt; IRBuilderT m ()) -&gt; IRBuilderT m ()
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Operand -&gt; (DataTag -&gt; m ()) -&gt; m ()
</span><a href="Hachi.Compiler.CodeGen.Constant.Data.html#withDataTag"><span class="hs-identifier hs-var">withDataTag</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262839"><span class="hs-identifier hs-var">d0</span></a></span><span> </span><span class="annot"><span class="annottext">((DataTag -&gt; IRBuilderT m ()) -&gt; IRBuilderT m ())
-&gt; (DataTag -&gt; IRBuilderT m ()) -&gt; IRBuilderT m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-222"></span><span>        </span><span class="annot"><span class="annottext">DataTag
</span><a href="Hachi.Compiler.CodeGen.Constant.Data.html#DataConstr"><span class="hs-identifier hs-var">DataConstr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-223"></span><span>            </span><span class="hs-comment">-- force both constructor tags and obtain the integer values</span><span>
</span><span id="line-224"></span><span>            </span><span id="local-6989586621679262822"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262822"><span class="hs-identifier hs-var">d0ctr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; IRBuilderT m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Constant.Data.html#loadConstrTag"><span class="hs-identifier hs-var">loadConstrTag</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262839"><span class="hs-identifier hs-var">d0</span></a></span><span>
</span><span id="line-225"></span><span>            </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
-&gt; Continuation
-&gt; Maybe Operand
-&gt; IRBuilderT m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *) (k :: PtrKind).
(MonadFail m, MonadModuleBuilder m, MonadIRBuilder m) =&gt;
ClosurePtr k
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Closure.html#enterClosure"><span class="hs-identifier hs-var">enterClosure</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262822"><span class="hs-identifier hs-var">d0ctr</span></a></span><span> </span><span class="annot"><span class="annottext">Continuation
</span><a href="Hachi.Compiler.CodeGen.CPS.html#cpsReturnCont"><span class="hs-identifier hs-var">cpsReturnCont</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Operand
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-226"></span><span>            </span><span id="local-6989586621679262820"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262820"><span class="hs-identifier hs-var">d0ctrTag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; IRBuilderT m Operand
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Type -&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.Constant.html#loadConstVal"><span class="hs-identifier hs-var">loadConstVal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#gmpTyPtr"><span class="hs-identifier hs-var">gmpTyPtr</span></a></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span>            </span><span id="local-6989586621679262819"><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262819"><span class="hs-identifier hs-var">d1ctr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; IRBuilderT m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Constant.Data.html#loadConstrTag"><span class="hs-identifier hs-var">loadConstrTag</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262837"><span class="hs-identifier hs-var">d1</span></a></span><span>
</span><span id="line-229"></span><span>            </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
-&gt; Continuation
-&gt; Maybe Operand
-&gt; IRBuilderT m (ClosurePtr 'DynamicPtr)
forall (m :: * -&gt; *) (k :: PtrKind).
(MonadFail m, MonadModuleBuilder m, MonadIRBuilder m) =&gt;
ClosurePtr k
-&gt; Continuation -&gt; Maybe Operand -&gt; m (ClosurePtr 'DynamicPtr)
</span><a href="Hachi.Compiler.CodeGen.Closure.html#enterClosure"><span class="hs-identifier hs-var">enterClosure</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262819"><span class="hs-identifier hs-var">d1ctr</span></a></span><span> </span><span class="annot"><span class="annottext">Continuation
</span><a href="Hachi.Compiler.CodeGen.CPS.html#cpsReturnCont"><span class="hs-identifier hs-var">cpsReturnCont</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Operand
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-230"></span><span>            </span><span id="local-6989586621679262818"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262818"><span class="hs-identifier hs-var">d1ctrTag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; IRBuilderT m Operand
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Type -&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.Constant.html#loadConstVal"><span class="hs-identifier hs-var">loadConstVal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Hachi.Compiler.CodeGen.Types.html#gmpTyPtr"><span class="hs-identifier hs-var">gmpTyPtr</span></a></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>            </span><span class="hs-comment">-- check to see if the constructor tags match</span><span>
</span><span id="line-233"></span><span>            </span><span id="local-6989586621679262817"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262817"><span class="hs-identifier hs-var">ctrBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; IRBuilderT m Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; ShortByteString -&gt; m Name
</span><span class="hs-identifier hs-var">freshName</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><span class="hs-string">&quot;ctr&quot;</span></span><span>
</span><span id="line-234"></span><span>            </span><span id="local-6989586621679262816"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262816"><span class="hs-identifier hs-var">cmpResult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; IRBuilderT m Operand
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
Operand -&gt; Operand -&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.Externals.GMP.html#mpzCmp"><span class="hs-identifier hs-var">mpzCmp</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262820"><span class="hs-identifier hs-var">d0ctrTag</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262818"><span class="hs-identifier hs-var">d1ctrTag</span></a></span><span>
</span><span id="line-235"></span><span>            </span><span id="local-6989586621679262815"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262815"><span class="hs-identifier hs-var">ctrMatch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntegerPredicate -&gt; Operand -&gt; Operand -&gt; IRBuilderT m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
IntegerPredicate -&gt; Operand -&gt; Operand -&gt; m Operand
</span><span class="hs-identifier hs-var">icmp</span></span><span> </span><span class="annot"><span class="annottext">IntegerPredicate
</span><span class="hs-identifier hs-var">LLVM.EQ</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262816"><span class="hs-identifier hs-var">cmpResult</span></a></span><span>
</span><span id="line-236"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="annot"><span class="annottext">(Constant -&gt; Operand) -&gt; Constant -&gt; Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Integer -&gt; Constant
</span><span class="hs-identifier hs-var">Int</span></span><span> </span><span class="annot"><span class="annottext">Word32
forall a. Num a =&gt; a
</span><a href="Hachi.Compiler.Platform.html#platformIntSize"><span class="hs-identifier hs-var">platformIntSize</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>            </span><span class="annot"><span class="annottext">Operand -&gt; Name -&gt; Name -&gt; IRBuilderT m ()
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Name -&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">condBr</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679262815"><span class="hs-identifier hs-var">ctrMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262817"><span class="hs-identifier hs-var">ctrBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262832"><span class="hs-identifier hs-var">neqBranch</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>            </span><span class="hs-comment">-- they match: check the arguments</span><span>
</span><span id="line-240"></span><span>            </span><span class="annot"><span class="annottext">Name -&gt; IRBuilderT m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">emitBlockStart</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679262817"><span class="hs-identifier hs-var">ctrBranch</span></a></span><span>
</span><span id="line-241"></span><span>            </span><span class="annot"><span class="annottext">EqFun (IRBuilderT m)
-&gt; ClosurePtr 'DynamicPtr
-&gt; ClosurePtr 'DynamicPtr
-&gt; IRBuilderT m ()
forall (m :: * -&gt; *).
(MonadCodeGen m, MonadIRBuilder m) =&gt;
EqFun m -&gt; ClosurePtr 'DynamicPtr -&gt; ClosurePtr 'DynamicPtr -&gt; m ()
</span><a href="Hachi.Compiler.CodeGen.Equality.html#eqList"><span class="hs-identifier hs-var">eqList</span></a></span><span> </span><span class="annot"><span class="annottext">EqFun (IRBuilderT m)
forall (m :: * -&gt; *) (k :: PtrKind) (k :: PtrKind).
(MonadFail m, MonadIRBuilder m, MonadModuleBuilder m) =&gt;
ClosurePtr k -&gt; ClosurePtr k -&gt; m Operand
</span><a href="#local-6989586621679262827"><span class="hs-identifier hs-var">callEqData</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262830"><span class="hs-identifier hs-var">d0ptr</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262828"><span class="hs-identifier hs-var">d1ptr</span></a></span><span>
</span><span id="line-242"></span><span>        </span><span class="annot"><span class="annottext">DataTag
</span><a href="Hachi.Compiler.CodeGen.Constant.Data.html#DataMap"><span class="hs-identifier hs-var">DataMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EqFun (IRBuilderT m)
-&gt; ClosurePtr 'DynamicPtr
-&gt; ClosurePtr 'DynamicPtr
-&gt; IRBuilderT m ()
forall (m :: * -&gt; *).
(MonadCodeGen m, MonadIRBuilder m) =&gt;
EqFun m -&gt; ClosurePtr 'DynamicPtr -&gt; ClosurePtr 'DynamicPtr -&gt; m ()
</span><a href="Hachi.Compiler.CodeGen.Equality.html#eqList"><span class="hs-identifier hs-var">eqList</span></a></span><span> </span><span class="annot"><span class="annottext">EqFun (IRBuilderT m)
forall (m :: * -&gt; *).
(MonadCodeGen m, MonadIRBuilder m) =&gt;
ClosurePtr 'DynamicPtr -&gt; ClosurePtr 'DynamicPtr -&gt; m Operand
</span><a href="Hachi.Compiler.CodeGen.Equality.html#eqPair"><span class="hs-identifier hs-var">eqPair</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262830"><span class="hs-identifier hs-var">d0ptr</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262828"><span class="hs-identifier hs-var">d1ptr</span></a></span><span>
</span><span id="line-243"></span><span>        </span><span class="annot"><span class="annottext">DataTag
</span><a href="Hachi.Compiler.CodeGen.Constant.Data.html#DataList"><span class="hs-identifier hs-var">DataList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EqFun (IRBuilderT m)
-&gt; ClosurePtr 'DynamicPtr
-&gt; ClosurePtr 'DynamicPtr
-&gt; IRBuilderT m ()
forall (m :: * -&gt; *).
(MonadCodeGen m, MonadIRBuilder m) =&gt;
EqFun m -&gt; ClosurePtr 'DynamicPtr -&gt; ClosurePtr 'DynamicPtr -&gt; m ()
</span><a href="Hachi.Compiler.CodeGen.Equality.html#eqList"><span class="hs-identifier hs-var">eqList</span></a></span><span> </span><span class="annot"><span class="annottext">EqFun (IRBuilderT m)
forall (m :: * -&gt; *) (k :: PtrKind) (k :: PtrKind).
(MonadFail m, MonadIRBuilder m, MonadModuleBuilder m) =&gt;
ClosurePtr k -&gt; ClosurePtr k -&gt; m Operand
</span><a href="#local-6989586621679262827"><span class="hs-identifier hs-var">callEqData</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262830"><span class="hs-identifier hs-var">d0ptr</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262828"><span class="hs-identifier hs-var">d1ptr</span></a></span><span>
</span><span id="line-244"></span><span>        </span><span class="annot"><span class="annottext">DataTag
</span><a href="Hachi.Compiler.CodeGen.Constant.Data.html#DataI"><span class="hs-identifier hs-var">DataI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr -&gt; ClosurePtr 'DynamicPtr -&gt; IRBuilderT m ()
forall (m :: * -&gt; *).
(MonadCodeGen m, MonadIRBuilder m) =&gt;
ClosurePtr 'DynamicPtr -&gt; ClosurePtr 'DynamicPtr -&gt; m ()
</span><a href="Hachi.Compiler.CodeGen.Equality.html#eqInteger"><span class="hs-identifier hs-var">eqInteger</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262830"><span class="hs-identifier hs-var">d0ptr</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262828"><span class="hs-identifier hs-var">d1ptr</span></a></span><span>
</span><span id="line-245"></span><span>        </span><span class="annot"><span class="annottext">DataTag
</span><a href="Hachi.Compiler.CodeGen.Constant.Data.html#DataB"><span class="hs-identifier hs-var">DataB</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr -&gt; ClosurePtr 'DynamicPtr -&gt; IRBuilderT m ()
forall (m :: * -&gt; *).
(MonadCodeGen m, MonadIRBuilder m) =&gt;
ClosurePtr 'DynamicPtr -&gt; ClosurePtr 'DynamicPtr -&gt; m ()
</span><a href="Hachi.Compiler.CodeGen.Equality.html#eqByteString"><span class="hs-identifier hs-var">eqByteString</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262830"><span class="hs-identifier hs-var">d0ptr</span></a></span><span> </span><span class="annot"><span class="annottext">ClosurePtr 'DynamicPtr
</span><a href="#local-6989586621679262828"><span class="hs-identifier hs-var">d1ptr</span></a></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-248"></span></pre></body></html>